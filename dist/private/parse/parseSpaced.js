if (typeof define !== 'function') var define = require('amdefine')(module);define(['exports', 'module', '../../CompileError', '../MsAst', '../Token', '../util', './context', './parse*', './parseName', './parseQuote', './parseSingle', './Slice'], function (exports, module, _CompileError, _MsAst, _Token, _util, _context, _parse, _parseName, _parseQuote, _parseSingle, _Slice) {
	'use strict';

	module.exports = parseSpaced;

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

	var _parseName2 = _interopRequireDefault(_parseName);

	var _parseQuote2 = _interopRequireDefault(_parseQuote);

	var _parseSingle2 = _interopRequireDefault(_parseSingle);

	var _Slice2 = _interopRequireDefault(_Slice);

	function parseSpaced(tokens) {
		const h = tokens.head(),
		      rest = tokens.tail();
		if ((0, _Token.isKeyword)(_Token.KW_Type, h)) return _MsAst.Call.contains(h.loc, parseSpaced(rest), _MsAst.LocalAccess.focus(h.loc));else if ((0, _Token.isKeyword)(_Token.KW_Lazy, h)) return new _MsAst.Lazy(h.loc, parseSpaced(rest));else if ((0, _Token.isKeyword)(_Token.KW_Dot, h)) {
			const name = (0, _parseName2.default)(rest.head());
			const rest2 = rest.tail();
			const member = new _MsAst.Member(h.loc, _MsAst.LocalAccess.this(h.loc), name);
			return rest2.isEmpty() ? member : parseSpacedFold(member, rest.tail());
		} else if ((0, _Token.isKeyword)(_Token.KW_Ellipsis, h)) return new _MsAst.Splat(tokens.loc, parseSpacedFold((0, _parseSingle2.default)(rest.head()), rest.tail));else if ((0, _Token.isKeyword)(_Token.KW_SuperVal, h)) {
			// TODO: handle sub here as well
			const h2 = rest.head();
			if ((0, _Token.isKeyword)(_Token.KW_Dot, h2)) {
				const tail = rest.tail();
				const sup = new _MsAst.SuperMember(h2.loc, parseMemberName(tail.head()));
				return parseSpacedFold(sup, tail.tail());
			} else if ((0, _Token.isGroup)(_Token.G_Parenthesis, h2) && _Slice2.default.group(h2).isEmpty()) {
				const x = new _MsAst.SuperCall(h2.loc, []);
				return parseSpacedFold(x, rest.tail());
			} else _context.context.fail(`Expected ${ (0, _CompileError.code)('.') } or ${ (0, _CompileError.code)('()') } after ${ (0, _CompileError.code)('super') }`);
		} else return parseSpacedFold((0, _parseSingle2.default)(h), rest);
	}

	const parseSpacedFold = (start, rest) => {
		let acc = start;
		for (let i = rest.start; i < rest.end; i = i + 1) {
			const token = rest.tokens[i];
			const loc = token.loc;
			if ((0, _Token.isKeyword)(_Token.KW_Dot, token)) {
				// If this was the last one, it would not be a KW_Dot but a KW_ObjAssign
				(0, _util.assert)(i < rest.end - 1);
				i = i + 1;
				const next = rest.tokens[i];
				acc = new _MsAst.Member(token.loc, acc, parseMemberName(next));
			} else if (token instanceof _Token.Keyword) switch (token.kind) {
				case _Token.KW_Focus:
					acc = new _MsAst.Call(token.loc, acc, [_MsAst.LocalAccess.focus(loc)]);
					break;
				case _Token.KW_Type:
					{
						const type = parseSpaced(rest._chopStart(i + 1));
						return _MsAst.Call.contains(token.loc, type, acc);
					}
				default:
					(0, _context.unexpected)(token);
			} else if (token instanceof _Token.Group) {
				const slice = _Slice2.default.group(token);
				switch (token.kind) {
					case _Token.G_Bracket:
						acc = _MsAst.Call.sub(loc, (0, _util.cat)(acc, (0, _parse.parseExprParts)(slice)));
						break;
					case _Token.G_Parenthesis:
						(0, _context.checkEmpty)(slice, () => `Use ${ (0, _CompileError.code)('(a b)') }, not ${ (0, _CompileError.code)('a(b)') }`);
						acc = new _MsAst.Call(loc, acc, []);
						break;
					case _Token.G_Quote:
						acc = new _MsAst.QuoteTemplate(loc, acc, (0, _parseQuote2.default)(slice));
						break;
					default:
						(0, _context.unexpected)(token);
				}
			}
		}
		return acc;
	};

	const parseMemberName = token => {
		const name = (0, _parseName.tryParseName)(token);
		if (name !== null) return name;else if ((0, _Token.isGroup)(_Token.G_Quote, token)) return (0, _parseQuote2.default)(_Slice2.default.group(token));else (0, _context.unexpected)(token);
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcnNlU3BhY2VkLmpzIiwicHJpdmF0ZS9wYXJzZS9wYXJzZVNwYWNlZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O2tCQ2F3QixXQUFXOzs7Ozs7Ozs7Ozs7QUFBcEIsVUFBUyxXQUFXLENBQUMsTUFBTSxFQUFFO0FBQzNDLFFBQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLEVBQUU7UUFBRSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFBO0FBQzdDLE1BQUksV0Fac0QsU0FBUyxTQUNuQyxPQUFPLEVBV2hCLENBQUMsQ0FBQyxFQUN4QixPQUFPLE9BZkQsSUFBSSxDQWVFLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQWY3QixXQUFXLENBZThCLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQSxLQUNwRSxJQUFJLFdBZGlELFNBQVMsU0FDekQsT0FBTyxFQWFXLENBQUMsQ0FBQyxFQUM3QixPQUFPLFdBakJLLElBQUksQ0FpQkEsQ0FBQyxDQUFDLEdBQUcsRUFBRSxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQSxLQUNyQyxJQUFJLFdBaEJpRCxTQUFTLFNBQVcsTUFBTSxFQWdCekQsQ0FBQyxDQUFDLEVBQUU7QUFDOUIsU0FBTSxJQUFJLEdBQUcseUJBQVUsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUE7QUFDbkMsU0FBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFBO0FBQ3pCLFNBQU0sTUFBTSxHQUFHLFdBckJnQixNQUFNLENBcUJYLENBQUMsQ0FBQyxHQUFHLEVBQUUsT0FyQmYsV0FBVyxDQXFCZ0IsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUMvRCxVQUFPLEtBQUssQ0FBQyxPQUFPLEVBQUUsR0FBRyxNQUFNLEdBQUcsZUFBZSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQTtHQUN0RSxNQUFNLElBQUksV0FyQitDLFNBQVMsU0FBbUIsV0FBVyxFQXFCL0QsQ0FBQyxDQUFDLEVBQ25DLE9BQU8sV0F4QitDLEtBQUssQ0F3QjFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsZUFBZSxDQUFDLDJCQUFZLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBLEtBQzlFLElBQUksV0F2QmlELFNBQVMsU0FDaEQsV0FBVyxFQXNCRSxDQUFDLENBQUMsRUFBRTs7QUFFbkMsU0FBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFBO0FBQ3RCLE9BQUksV0ExQnFELFNBQVMsU0FBVyxNQUFNLEVBMEI3RCxFQUFFLENBQUMsRUFBRTtBQUMxQixVQUFNLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUE7QUFDeEIsVUFBTSxHQUFHLEdBQUcsV0E5QjJELFdBQVcsQ0E4QnRELEVBQUUsQ0FBQyxHQUFHLEVBQUUsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUE7QUFDakUsV0FBTyxlQUFlLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFBO0lBQ3hDLE1BQU0sSUFBSSxXQTlCcUMsT0FBTyxTQUEvQixhQUFhLEVBOEJILEVBQUUsQ0FBQyxJQUFJLGdCQUFNLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtBQUNuRSxVQUFNLENBQUMsR0FBRyxXQWpDa0QsU0FBUyxDQWlDN0MsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQTtBQUNuQyxXQUFPLGVBQWUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUE7SUFDdEMsTUFDQSxTQS9CaUIsT0FBTyxDQStCaEIsSUFBSSxDQUFDLENBQUMsU0FBUyxHQUFFLGtCQXJDcEIsSUFBSSxFQXFDcUIsR0FBRyxDQUFDLEVBQUMsSUFBSSxHQUFFLGtCQXJDcEMsSUFBSSxFQXFDcUMsSUFBSSxDQUFDLEVBQUMsT0FBTyxHQUFFLGtCQXJDeEQsSUFBSSxFQXFDeUQsT0FBTyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUE7R0FDOUUsTUFDQSxPQUFPLGVBQWUsQ0FBQywyQkFBWSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtFQUM3Qzs7QUFFRCxPQUFNLGVBQWUsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLEtBQUs7QUFDeEMsTUFBSSxHQUFHLEdBQUcsS0FBSyxDQUFBO0FBQ2YsT0FBSyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO0FBQ2pELFNBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDNUIsU0FBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQTtBQUNyQixPQUFJLFdBNUNxRCxTQUFTLFNBQVcsTUFBTSxFQTRDN0QsS0FBSyxDQUFDLEVBQUU7O0FBRTdCLGNBNUNLLE1BQU0sRUE0Q0osQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUE7QUFDeEIsS0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDVCxVQUFNLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQzNCLE9BQUcsR0FBRyxXQW5Ed0IsTUFBTSxDQW1EbkIsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7SUFDdkQsTUFBTSxJQUFJLEtBQUssbUJBbERvRCxPQUFPLEFBa0R4QyxFQUNsQyxRQUFRLEtBQUssQ0FBQyxJQUFJO0FBQ2pCLGdCQW5ESCxRQUFRO0FBb0RKLFFBQUcsR0FBRyxXQXZESCxJQUFJLENBdURRLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsT0F2RGpCLFdBQVcsQ0F1RGtCLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDeEQsV0FBSztBQUFBLEFBQ04sZ0JBdEQ2QixPQUFPO0FBc0R0QjtBQUNiLFlBQU0sSUFBSSxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ2hELGFBQU8sT0EzREosSUFBSSxDQTJESyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUE7TUFDMUM7QUFBQSxBQUNEO0FBQ0Msa0JBekR3QixVQUFVLEVBeUR2QixLQUFLLENBQUMsQ0FBQTtBQUFBLElBQ2xCLE1BQ0csSUFBSSxLQUFLLG1CQTlEUixLQUFLLEFBOERvQixFQUFFO0FBQ2hDLFVBQU0sS0FBSyxHQUFHLGdCQUFNLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTtBQUNoQyxZQUFRLEtBQUssQ0FBQyxJQUFJO0FBQ2pCLGlCQWpFVyxTQUFTO0FBa0VuQixTQUFHLEdBQUcsT0FwRUgsSUFBSSxDQW9FSSxHQUFHLENBQUMsR0FBRyxFQUFFLFVBaEVULEdBQUcsRUFnRVUsR0FBRyxFQUFFLFdBOUQxQixjQUFjLEVBOEQyQixLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDcEQsWUFBSztBQUFBLEFBQ04saUJBcEVzQixhQUFhO0FBcUVsQyxtQkFsRUcsVUFBVSxFQWtFRixLQUFLLEVBQUUsTUFBTSxDQUFDLElBQUksR0FBRSxrQkF4RTVCLElBQUksRUF3RTZCLE9BQU8sQ0FBQyxFQUFDLE1BQU0sR0FBRSxrQkF4RWxELElBQUksRUF3RW1ELE1BQU0sQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ3BFLFNBQUcsR0FBRyxXQXhFSCxJQUFJLENBd0VRLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUE7QUFDNUIsWUFBSztBQUFBLEFBQ04saUJBeEVxQyxPQUFPO0FBeUUzQyxTQUFHLEdBQUcsV0EzRThCLGFBQWEsQ0EyRXpCLEdBQUcsRUFBRSxHQUFHLEVBQUUsMEJBQVcsS0FBSyxDQUFDLENBQUMsQ0FBQTtBQUNwRCxZQUFLO0FBQUEsQUFDTjtBQUNDLG1CQXpFd0IsVUFBVSxFQXlFdkIsS0FBSyxDQUFDLENBQUE7QUFBQSxLQUNsQjtJQUNEO0dBQ0Q7QUFDRCxTQUFPLEdBQUcsQ0FBQTtFQUNWLENBQUE7O0FBRUQsT0FBTSxlQUFlLEdBQUcsS0FBSyxJQUFJO0FBQ2hDLFFBQU0sSUFBSSxHQUFHLGVBL0VLLFlBQVksRUErRUosS0FBSyxDQUFDLENBQUE7QUFDaEMsTUFBSSxJQUFJLEtBQUssSUFBSSxFQUNoQixPQUFPLElBQUksQ0FBQSxLQUNQLElBQUksV0F2RndDLE9BQU8sU0FBaEIsT0FBTyxFQXVGckIsS0FBSyxDQUFDLEVBQy9CLE9BQU8sMEJBQVcsZ0JBQU0sS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUEsS0FFckMsYUF2RjJCLFVBQVUsRUF1RjFCLEtBQUssQ0FBQyxDQUFBO0VBQ2xCLENBQUEiLCJmaWxlIjoicHJpdmF0ZS9wYXJzZS9wYXJzZVNwYWNlZC5qcyIsInNvdXJjZXNDb250ZW50IjpbbnVsbCwiaW1wb3J0IHtjb2RlfSBmcm9tICcuLi8uLi9Db21waWxlRXJyb3InXG5pbXBvcnQge0NhbGwsIExhenksIExvY2FsQWNjZXNzLCBNZW1iZXIsIFF1b3RlVGVtcGxhdGUsIFNwbGF0LCBTdXBlckNhbGwsIFN1cGVyTWVtYmVyXG5cdH0gZnJvbSAnLi4vTXNBc3QnXG5pbXBvcnQge0dyb3VwLCBHX0JyYWNrZXQsIEdfUGFyZW50aGVzaXMsIEdfUXVvdGUsIGlzR3JvdXAsIGlzS2V5d29yZCwgS2V5d29yZCwgS1dfRG90LCBLV19FbGxpcHNpcyxcblx0S1dfRm9jdXMsIEtXX0xhenksIEtXX1N1cGVyVmFsLCBLV19UeXBlfSBmcm9tICcuLi9Ub2tlbidcbmltcG9ydCB7YXNzZXJ0LCBjYXR9IGZyb20gJy4uL3V0aWwnXG5pbXBvcnQge2NoZWNrRW1wdHksIGNvbnRleHQsIHVuZXhwZWN0ZWR9IGZyb20gJy4vY29udGV4dCdcbmltcG9ydCB7cGFyc2VFeHByUGFydHN9IGZyb20gJy4vcGFyc2UqJ1xuaW1wb3J0IHBhcnNlTmFtZSwge3RyeVBhcnNlTmFtZX0gZnJvbSAnLi9wYXJzZU5hbWUnXG5pbXBvcnQgcGFyc2VRdW90ZSBmcm9tICcuL3BhcnNlUXVvdGUnXG5pbXBvcnQgcGFyc2VTaW5nbGUgZnJvbSAnLi9wYXJzZVNpbmdsZSdcbmltcG9ydCBTbGljZSBmcm9tICcuL1NsaWNlJ1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBwYXJzZVNwYWNlZCh0b2tlbnMpIHtcblx0Y29uc3QgaCA9IHRva2Vucy5oZWFkKCksIHJlc3QgPSB0b2tlbnMudGFpbCgpXG5cdGlmIChpc0tleXdvcmQoS1dfVHlwZSwgaCkpXG5cdFx0cmV0dXJuIENhbGwuY29udGFpbnMoaC5sb2MsIHBhcnNlU3BhY2VkKHJlc3QpLCBMb2NhbEFjY2Vzcy5mb2N1cyhoLmxvYykpXG5cdGVsc2UgaWYgKGlzS2V5d29yZChLV19MYXp5LCBoKSlcblx0XHRyZXR1cm4gbmV3IExhenkoaC5sb2MsIHBhcnNlU3BhY2VkKHJlc3QpKVxuXHRlbHNlIGlmIChpc0tleXdvcmQoS1dfRG90LCBoKSkge1xuXHRcdGNvbnN0IG5hbWUgPSBwYXJzZU5hbWUocmVzdC5oZWFkKCkpXG5cdFx0Y29uc3QgcmVzdDIgPSByZXN0LnRhaWwoKVxuXHRcdGNvbnN0IG1lbWJlciA9IG5ldyBNZW1iZXIoaC5sb2MsIExvY2FsQWNjZXNzLnRoaXMoaC5sb2MpLCBuYW1lKVxuXHRcdHJldHVybiByZXN0Mi5pc0VtcHR5KCkgPyBtZW1iZXIgOiBwYXJzZVNwYWNlZEZvbGQobWVtYmVyLCByZXN0LnRhaWwoKSlcblx0fSBlbHNlIGlmIChpc0tleXdvcmQoS1dfRWxsaXBzaXMsIGgpKVxuXHRcdHJldHVybiBuZXcgU3BsYXQodG9rZW5zLmxvYywgcGFyc2VTcGFjZWRGb2xkKHBhcnNlU2luZ2xlKHJlc3QuaGVhZCgpKSwgcmVzdC50YWlsKSlcblx0ZWxzZSBpZiAoaXNLZXl3b3JkKEtXX1N1cGVyVmFsLCBoKSkge1xuXHRcdC8vIFRPRE86IGhhbmRsZSBzdWIgaGVyZSBhcyB3ZWxsXG5cdFx0Y29uc3QgaDIgPSByZXN0LmhlYWQoKVxuXHRcdGlmIChpc0tleXdvcmQoS1dfRG90LCBoMikpIHtcblx0XHRcdGNvbnN0IHRhaWwgPSByZXN0LnRhaWwoKVxuXHRcdFx0Y29uc3Qgc3VwID0gbmV3IFN1cGVyTWVtYmVyKGgyLmxvYywgcGFyc2VNZW1iZXJOYW1lKHRhaWwuaGVhZCgpKSlcblx0XHRcdHJldHVybiBwYXJzZVNwYWNlZEZvbGQoc3VwLCB0YWlsLnRhaWwoKSlcblx0XHR9IGVsc2UgaWYgKGlzR3JvdXAoR19QYXJlbnRoZXNpcywgaDIpICYmIFNsaWNlLmdyb3VwKGgyKS5pc0VtcHR5KCkpIHtcblx0XHRcdGNvbnN0IHggPSBuZXcgU3VwZXJDYWxsKGgyLmxvYywgW10pXG5cdFx0XHRyZXR1cm4gcGFyc2VTcGFjZWRGb2xkKHgsIHJlc3QudGFpbCgpKVxuXHRcdH0gZWxzZVxuXHRcdFx0Y29udGV4dC5mYWlsKGBFeHBlY3RlZCAke2NvZGUoJy4nKX0gb3IgJHtjb2RlKCcoKScpfSBhZnRlciAke2NvZGUoJ3N1cGVyJyl9YClcblx0fSBlbHNlXG5cdFx0cmV0dXJuIHBhcnNlU3BhY2VkRm9sZChwYXJzZVNpbmdsZShoKSwgcmVzdClcbn1cblxuY29uc3QgcGFyc2VTcGFjZWRGb2xkID0gKHN0YXJ0LCByZXN0KSA9PiB7XG5cdGxldCBhY2MgPSBzdGFydFxuXHRmb3IgKGxldCBpID0gcmVzdC5zdGFydDsgaSA8IHJlc3QuZW5kOyBpID0gaSArIDEpIHtcblx0XHRjb25zdCB0b2tlbiA9IHJlc3QudG9rZW5zW2ldXG5cdFx0Y29uc3QgbG9jID0gdG9rZW4ubG9jXG5cdFx0aWYgKGlzS2V5d29yZChLV19Eb3QsIHRva2VuKSkge1xuXHRcdFx0Ly8gSWYgdGhpcyB3YXMgdGhlIGxhc3Qgb25lLCBpdCB3b3VsZCBub3QgYmUgYSBLV19Eb3QgYnV0IGEgS1dfT2JqQXNzaWduXG5cdFx0XHRhc3NlcnQoaSA8IHJlc3QuZW5kIC0gMSlcblx0XHRcdGkgPSBpICsgMVxuXHRcdFx0Y29uc3QgbmV4dCA9IHJlc3QudG9rZW5zW2ldXG5cdFx0XHRhY2MgPSBuZXcgTWVtYmVyKHRva2VuLmxvYywgYWNjLCBwYXJzZU1lbWJlck5hbWUobmV4dCkpXG5cdFx0fSBlbHNlIGlmICh0b2tlbiBpbnN0YW5jZW9mIEtleXdvcmQpXG5cdFx0XHRzd2l0Y2ggKHRva2VuLmtpbmQpIHtcblx0XHRcdFx0Y2FzZSBLV19Gb2N1czpcblx0XHRcdFx0XHRhY2MgPSBuZXcgQ2FsbCh0b2tlbi5sb2MsIGFjYywgW0xvY2FsQWNjZXNzLmZvY3VzKGxvYyldKVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdGNhc2UgS1dfVHlwZToge1xuXHRcdFx0XHRcdGNvbnN0IHR5cGUgPSBwYXJzZVNwYWNlZChyZXN0Ll9jaG9wU3RhcnQoaSArIDEpKVxuXHRcdFx0XHRcdHJldHVybiBDYWxsLmNvbnRhaW5zKHRva2VuLmxvYywgdHlwZSwgYWNjKVxuXHRcdFx0XHR9XG5cdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0dW5leHBlY3RlZCh0b2tlbilcblx0XHRcdH1cblx0XHRlbHNlIGlmICh0b2tlbiBpbnN0YW5jZW9mIEdyb3VwKSB7XG5cdFx0XHRjb25zdCBzbGljZSA9IFNsaWNlLmdyb3VwKHRva2VuKVxuXHRcdFx0c3dpdGNoICh0b2tlbi5raW5kKSB7XG5cdFx0XHRcdGNhc2UgR19CcmFja2V0OlxuXHRcdFx0XHRcdGFjYyA9IENhbGwuc3ViKGxvYywgY2F0KGFjYywgcGFyc2VFeHByUGFydHMoc2xpY2UpKSlcblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRjYXNlIEdfUGFyZW50aGVzaXM6XG5cdFx0XHRcdFx0Y2hlY2tFbXB0eShzbGljZSwgKCkgPT4gYFVzZSAke2NvZGUoJyhhIGIpJyl9LCBub3QgJHtjb2RlKCdhKGIpJyl9YClcblx0XHRcdFx0XHRhY2MgPSBuZXcgQ2FsbChsb2MsIGFjYywgW10pXG5cdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0Y2FzZSBHX1F1b3RlOlxuXHRcdFx0XHRcdGFjYyA9IG5ldyBRdW90ZVRlbXBsYXRlKGxvYywgYWNjLCBwYXJzZVF1b3RlKHNsaWNlKSlcblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdHVuZXhwZWN0ZWQodG9rZW4pXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdHJldHVybiBhY2Ncbn1cblxuY29uc3QgcGFyc2VNZW1iZXJOYW1lID0gdG9rZW4gPT4ge1xuXHRjb25zdCBuYW1lID0gdHJ5UGFyc2VOYW1lKHRva2VuKVxuXHRpZiAobmFtZSAhPT0gbnVsbClcblx0XHRyZXR1cm4gbmFtZVxuXHRlbHNlIGlmIChpc0dyb3VwKEdfUXVvdGUsIHRva2VuKSlcblx0XHRyZXR1cm4gcGFyc2VRdW90ZShTbGljZS5ncm91cCh0b2tlbikpXG5cdGVsc2Vcblx0XHR1bmV4cGVjdGVkKHRva2VuKVxufVxuIl0sInNvdXJjZVJvb3QiOiIvc3JjIn0=
