{"version":3,"sources":["private/transpile/transpileExcept.js"],"names":[],"mappings":"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","file":"private/transpile/transpileExcept.js","sourcesContent":["(function (factory) {\n    if (typeof module === 'object' && typeof module.exports === 'object') {\n        var v = factory(require, exports); if (v !== undefined) module.exports = v;\n    }\n    else if (typeof define === 'function' && define.amd) {\n        define([\"require\", \"exports\", 'esast/lib/Declaration', 'esast/lib/Expression', 'esast/lib/Identifier', 'esast/lib/Statement', 'op/Op', '../util', './transpileBlock', './transpileMisc', './transpileVal', './util'], factory);\n    }\n})(function (require, exports) {\n    \"use strict\";\n    var Declaration_1 = require('esast/lib/Declaration');\n    var Expression_1 = require('esast/lib/Expression');\n    var Identifier_1 = require('esast/lib/Identifier');\n    var Statement_1 = require('esast/lib/Statement');\n    var Op_1 = require('op/Op');\n    var util_1 = require('../util');\n    var transpileBlock_1 = require('./transpileBlock');\n    var transpileMisc_1 = require('./transpileMisc');\n    var transpileVal_1 = require('./transpileVal');\n    var util_2 = require('./util');\n    function transpileExceptValNoLoc(_) {\n        return util_2.blockWrap(new Statement_1.BlockStatement(util_1.toArray(transpileExceptDoNoLoc(_))));\n    }\n    exports.transpileExceptValNoLoc = transpileExceptValNoLoc;\n    function transpileExceptDoNoLoc(_) {\n        const { try: _try, typedCatches, opCatchAll, opElse, opFinally } = _;\n        return Op_1.caseOp(opElse, _else => transpileWithElse(_, _else), () => new Statement_1.TryStatement(transpileBlock_1.default(_try), transpileCatches(typedCatches, opCatchAll, false), Op_1.opMap(opFinally, transpileBlock_1.transpileBlockDo)));\n    }\n    exports.transpileExceptDoNoLoc = transpileExceptDoNoLoc;\n    function transpileWithElse(_, _else) {\n        const { try: _try, typedCatches, opCatchAll, opFinally } = _;\n        const tryAst = transpileBlock_1.default(_else, util_1.cat(util_2.tLines(_try.lines), SetExceptElse));\n        const catchAst = transpileCatches(typedCatches, opCatchAll, true);\n        return [LetExceptElse, new Statement_1.TryStatement(tryAst, catchAst, Op_1.opMap(opFinally, transpileBlock_1.transpileBlockDo))];\n    }\n    function transpileCatches(typedCatches, opCatchAll, hasElse) {\n        const allCatches = util_1.cat(typedCatches, opCatchAll);\n        const needsErrorDeclare = !util_1.allSame(allCatches, _ => _.caught.name);\n        const idError = needsErrorDeclare ? IdError : util_2.idForDeclareCached(allCatches[0].caught);\n        const throwIfOnElse = () => new Statement_1.IfStatement(IdExceptElse, new Statement_1.ThrowStatement(idError));\n        const catchAll = Op_1.caseOp(opCatchAll, _ => transpileCatch(_, needsErrorDeclare), () => new Statement_1.BlockStatement([new Statement_1.ThrowStatement(idError)]));\n        const catchBlock = (() => {\n            if (util_1.isEmpty(typedCatches)) {\n                if (hasElse)\n                    catchAll.body.unshift(throwIfOnElse());\n                return catchAll;\n            }\n            else {\n                let catches = catchAll;\n                for (const typedCatch of util_1.reverseIter(typedCatches)) {\n                    const type = typedCatch.caught.opType;\n                    const cond = util_2.msCall('contains', transpileVal_1.default(type), idError);\n                    const then = transpileCatch(typedCatch, needsErrorDeclare);\n                    catches = new Statement_1.IfStatement(cond, then, catches);\n                }\n                return new Statement_1.BlockStatement(hasElse ? [throwIfOnElse(), catches] : [catches]);\n            }\n        })();\n        return new Statement_1.CatchClause(idError, catchBlock);\n    }\n    function transpileCatch(_, needsErrorDeclare) {\n        const { caught, block } = _;\n        return util_2.loc(_, (() => {\n            if (needsErrorDeclare) {\n                const declareError = new Declaration_1.VariableDeclarationLet([new Declaration_1.VariableDeclarator(transpileMisc_1.transpileLocalDeclare(caught), IdError)]);\n                return transpileBlock_1.transpileBlockNoLoc(block, declareError);\n            }\n            else\n                return transpileBlock_1.transpileBlockNoLoc(block);\n        })());\n    }\n    const IdError = new Identifier_1.default('error_'), IdExceptElse = new Identifier_1.default('exceptElse_'), LetExceptElse = new Declaration_1.VariableDeclarationLet([new Declaration_1.VariableDeclarator(IdExceptElse, new Expression_1.LiteralBoolean(false))]), SetExceptElse = new Statement_1.ExpressionStatement(new Expression_1.AssignmentExpression('=', IdExceptElse, new Expression_1.LiteralBoolean(true)));\n});\n"],"sourceRoot":"/source/"}