if (typeof define !== 'function') var define = require('amdefine')(module);define(['exports', 'module', '../../CompileError', '../MsAst', '../Token', '../util', './context', './parse*', './parseQuote', './parseSingle', './Slice'], function (exports, module, _CompileError, _MsAst, _Token, _util, _context, _parse, _parseQuote, _parseSingle, _Slice) {
	'use strict';

	module.exports = parseSpaced;

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

	var _parseQuote2 = _interopRequireDefault(_parseQuote);

	var _parseSingle2 = _interopRequireDefault(_parseSingle);

	var _Slice2 = _interopRequireDefault(_Slice);

	function parseSpaced(tokens) {
		const h = tokens.head(),
		      rest = tokens.tail();
		if ((0, _Token.isKeyword)(_Token.KW_Type, h)) return _MsAst.Call.contains(h.loc, parseSpaced(rest), _MsAst.LocalAccess.focus(h.loc));else if ((0, _Token.isKeyword)(_Token.KW_Lazy, h)) return new _MsAst.Lazy(h.loc, parseSpaced(rest));else if ((0, _Token.isKeyword)(_Token.KW_SuperVal, h)) {
			// TODO: handle sub here as well
			const h2 = rest.head();
			if (h2 instanceof _Token.DotName) {
				_context.context.check(h2.nDots === 1, h2.loc, 'Too many dots!');
				const x = new _MsAst.SuperMember(h2.loc, h2.name);
				return parseSpacedFold(x, rest.tail());
			} else if ((0, _Token.isGroup)(_Token.G_Parenthesis, h2) && _Slice2.default.group(h2).isEmpty()) {
				const x = new _MsAst.SuperCall(h2.loc, []);
				return parseSpacedFold(x, rest.tail());
			} else _context.context.fail(`Expected ${ (0, _CompileError.code)('.') } or ${ (0, _CompileError.code)('()') } after ${ (0, _CompileError.code)('super') }`);
		} else return parseSpacedFold((0, _parseSingle2.default)(h), rest);
	}

	const parseSpacedFold = (start, rest) => {
		let acc = start;
		for (let i = rest.start; i < rest.end; i = i + 1) {
			const token = rest.tokens[i];
			const loc = token.loc;
			if (token instanceof _Token.DotName) {
				_context.context.check(token.nDots === 1, token.loc, 'Too many dots!');
				acc = new _MsAst.Member(token.loc, acc, token.name);
				continue;
			}
			if (token instanceof _Token.Keyword) switch (token.kind) {
				case _Token.KW_Focus:
					acc = new _MsAst.Call(token.loc, acc, [_MsAst.LocalAccess.focus(loc)]);
					continue;
				case _Token.KW_Type:
					{
						const type = parseSpaced(rest._chopStart(i + 1));
						return _MsAst.Call.contains(token.loc, type, acc);
					}
				default:
			}
			if (token instanceof _Token.Group) {
				const slice = _Slice2.default.group(token);
				switch (token.kind) {
					case _Token.G_Bracket:
						acc = _MsAst.Call.sub(loc, (0, _util.cat)(acc, (0, _parse.parseExprParts)(slice)));
						continue;
					case _Token.G_Parenthesis:
						(0, _context.checkEmpty)(slice, () => `Use ${ (0, _CompileError.code)('(a b)') }, not ${ (0, _CompileError.code)('a(b)') }`);
						acc = new _MsAst.Call(loc, acc, []);
						continue;
					case _Token.G_Quote:
						acc = new _MsAst.QuoteTemplate(loc, acc, (0, _parseQuote2.default)(slice));
						continue;
					default:
				}
			}
			_context.context.fail(token.loc, `Expected member or sub, not ${ token }`);
		}
		return acc;
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcnNlU3BhY2VkLmpzIiwicHJpdmF0ZS9wYXJzZS9wYXJzZVNwYWNlZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O2tCQ1d3QixXQUFXOzs7Ozs7Ozs7O0FBQXBCLFVBQVMsV0FBVyxDQUFDLE1BQU0sRUFBRTtBQUMzQyxRQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsSUFBSSxFQUFFO1FBQUUsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQTtBQUM3QyxNQUFJLFdBWCtELFNBQVMsU0FDdEQsT0FBTyxFQVVOLENBQUMsQ0FBQyxFQUN4QixPQUFPLE9BYkQsSUFBSSxDQWFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQWI3QixXQUFXLENBYThCLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQSxLQUNwRSxJQUFJLFdBYjBELFNBQVMsU0FDNUUsT0FBTyxFQVlxQixDQUFDLENBQUMsRUFDN0IsT0FBTyxXQWZLLElBQUksQ0FlQSxDQUFDLENBQUMsR0FBRyxFQUFFLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBLEtBQ3JDLElBQUksV0FmMEQsU0FBUyxTQUNuRSxXQUFXLEVBY1ksQ0FBQyxDQUFDLEVBQUU7O0FBRW5DLFNBQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQTtBQUN0QixPQUFJLEVBQUUsbUJBbEJBLE9BQU8sQUFrQlksRUFBRTtBQUMxQixhQWhCaUIsT0FBTyxDQWdCaEIsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQTtBQUN2RCxVQUFNLENBQUMsR0FBRyxXQXJCc0QsV0FBVyxDQXFCakQsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDMUMsV0FBTyxlQUFlLENBQUMsQ0FBQyxF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bUJBeERHLFVBQVUsRUF3REYsS0FBSyxFQUFFLE1BQ2pCLENBQUMsSUFBSSxHQUFFLGtCQTlETCxJQUFJLEVBOERNLE9BQU8sQ0FBQyxFQUFDLE1BQU0sR0FBRSxrQkE5RDNCLElBQUksRUE4RDRCLE1BQU0sQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFBO0FBQzdDLFNBQUcsR0FBRyxXQTlESCxJQUFJLENBOERRLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUE7QUFDNUIsZUFBUTtBQUFBLEFBQ1QsaUJBL0Q4QyxPQUFPO0FBZ0VwRCxTQUFHLEdBQUcsV0FqRThCLGFBQWEsQ0FpRXpCLEdBQUcsRUFBRSxHQUFHLEVBQUUsMEJBQVcsS0FBSyxDQUFDLENBQUMsQ0FBQTtBQUNwRCxlQUFRO0FBQUEsQUFDVCxhQUFRO0tBQ1I7SUFDRDtBQUNELFlBbEVrQixPQUFPLENBa0VqQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLDRCQUE0QixHQUFFLEtBQUssRUFBQyxDQUFDLENBQUMsQ0FBQTtHQUMvRDtBQUNELFNBQU8sR0FBRyxDQUFBO0VBQ1YsQ0FBQSIsImZpbGUiOiJwcml2YXRlL3BhcnNlL3BhcnNlU3BhY2VkLmpzIiwic291cmNlc0NvbnRlbnQiOltudWxsLCJpbXBvcnQge2NvZGV9IGZyb20gJy4uLy4uL0NvbXBpbGVFcnJvcidcbmltcG9ydCB7Q2FsbCwgTGF6eSwgTG9jYWxBY2Nlc3MsIE1lbWJlciwgUXVvdGVUZW1wbGF0ZSwgU3VwZXJDYWxsLCBTdXBlck1lbWJlcn0gZnJvbSAnLi4vTXNBc3QnXG5pbXBvcnQge0RvdE5hbWUsIEdyb3VwLCBHX0JyYWNrZXQsIEdfUGFyZW50aGVzaXMsIEdfUXVvdGUsIGlzR3JvdXAsIGlzS2V5d29yZCwgS2V5d29yZCwgS1dfRm9jdXMsXG5cdEtXX0xhenksIEtXX1N1cGVyVmFsLCBLV19UeXBlfSBmcm9tICcuLi9Ub2tlbidcbmltcG9ydCB7Y2F0fSBmcm9tICcuLi91dGlsJ1xuaW1wb3J0IHtjaGVja0VtcHR5LCBjb250ZXh0fSBmcm9tICcuL2NvbnRleHQnXG5pbXBvcnQge3BhcnNlRXhwclBhcnRzfSBmcm9tICcuL3BhcnNlKidcbmltcG9ydCBwYXJzZVF1b3RlIGZyb20gJy4vcGFyc2VRdW90ZSdcbmltcG9ydCBwYXJzZVNpbmdsZSBmcm9tICcuL3BhcnNlU2luZ2xlJ1xuaW1wb3J0IFNsaWNlIGZyb20gJy4vU2xpY2UnXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHBhcnNlU3BhY2VkKHRva2Vucykge1xuXHRjb25zdCBoID0gdG9rZW5zLmhlYWQoKSwgcmVzdCA9IHRva2Vucy50YWlsKClcblx0aWYgKGlzS2V5d29yZChLV19UeXBlLCBoKSlcblx0XHRyZXR1cm4gQ2FsbC5jb250YWlucyhoLmxvYywgcGFyc2VTcGFjZWQocmVzdCksIExvY2FsQWNjZXNzLmZvY3VzKGgubG9jKSlcblx0ZWxzZSBpZiAoaXNLZXl3b3JkKEtXX0xhenksIGgpKVxuXHRcdHJldHVybiBuZXcgTGF6eShoLmxvYywgcGFyc2VTcGFjZWQocmVzdCkpXG5cdGVsc2UgaWYgKGlzS2V5d29yZChLV19TdXBlclZhbCwgaCkpIHtcblx0XHQvLyBUT0RPOiBoYW5kbGUgc3ViIGhlcmUgYXMgd2VsbFxuXHRcdGNvbnN0IGgyID0gcmVzdC5oZWFkKClcblx0XHRpZiAoaDIgaW5zdGFuY2VvZiBEb3ROYW1lKSB7XG5cdFx0XHRjb250ZXh0LmNoZWNrKGgyLm5Eb3RzID09PSAxLCBoMi5sb2MsICdUb28gbWFueSBkb3RzIScpXG5cdFx0XHRjb25zdCB4ID0gbmV3IFN1cGVyTWVtYmVyKGgyLmxvYywgaDIubmFtZSlcblx0XHRcdHJldHVybiBwYXJzZVNwYWNlZEZvbGQoeCwgcmVzdC50YWlsKCkpXG5cdFx0fSBlbHNlIGlmIChpc0dyb3VwKEdfUGFyZW50aGVzaXMsIGgyKSAmJiBTbGljZS5ncm91cChoMikuaXNFbXB0eSgpKSB7XG5cdFx0XHRjb25zdCB4ID0gbmV3IFN1cGVyQ2FsbChoMi5sb2MsIFtdKVxuXHRcdFx0cmV0dXJuIHBhcnNlU3BhY2VkRm9sZCh4LCByZXN0LnRhaWwoKSlcblx0XHR9IGVsc2Vcblx0XHRcdGNvbnRleHQuZmFpbChgRXhwZWN0ZWQgJHtjb2RlKCcuJyl9IG9yICR7Y29kZSgnKCknKX0gYWZ0ZXIgJHtjb2RlKCdzdXBlcicpfWApXG5cdH0gZWxzZVxuXHRcdHJldHVybiBwYXJzZVNwYWNlZEZvbGQocGFyc2VTaW5nbGUoaCksIHJlc3QpXG59XG5cbmNvbnN0IHBhcnNlU3BhY2VkRm9sZCA9IChzdGFydCwgcmVzdCkgPT4ge1xuXHRsZXQgYWNjID0gc3RhcnRcblx0Zm9yIChsZXQgaSA9IHJlc3Quc3RhcnQ7IGkgPCByZXN0LmVuZDsgaSA9IGkgKyAxKSB7XG5cdFx0Y29uc3QgdG9rZW4gPSByZXN0LnRva2Vuc1tpXVxuXHRcdGNvbnN0IGxvYyA9IHRva2VuLmxvY1xuXHRcdGlmICh0b2tlbiBpbnN0YW5jZW9mIERvdE5hbWUpIHtcblx0XHRcdGNvbnRleHQuY2hlY2sodG9rZW4ubkRvdHMgPT09IDEsIHRva2VuLmxvYywgJ1RvbyBtYW55IGRvdHMhJylcblx0XHRcdGFjYyA9IG5ldyBNZW1iZXIodG9rZW4ubG9jLCBhY2MsIHRva2VuLm5hbWUpXG5cdFx0XHRjb250aW51ZVxuXHRcdH1cblx0XHRpZiAodG9rZW4gaW5zdGFuY2VvZiBLZXl3b3JkKVxuXHRcdFx0c3dpdGNoICh0b2tlbi5raW5kKSB7XG5cdFx0XHRcdGNhc2UgS1dfRm9jdXM6XG5cdFx0XHRcdFx0YWNjID0gbmV3IENhbGwodG9rZW4ubG9jLCBhY2MsIFtMb2NhbEFjY2Vzcy5mb2N1cyhsb2MpXSlcblx0XHRcdFx0XHRjb250aW51ZVxuXHRcdFx0XHRjYXNlIEtXX1R5cGU6IHtcblx0XHRcdFx0XHRjb25zdCB0eXBlID0gcGFyc2VTcGFjZWQocmVzdC5fY2hvcFN0YXJ0KGkgKyAxKSlcblx0XHRcdFx0XHRyZXR1cm4gQ2FsbC5jb250YWlucyh0b2tlbi5sb2MsIHR5cGUsIGFjYylcblx0XHRcdFx0fVxuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0fVxuXHRcdGlmICh0b2tlbiBpbnN0YW5jZW9mIEdyb3VwKSB7XG5cdFx0XHRjb25zdCBzbGljZSA9IFNsaWNlLmdyb3VwKHRva2VuKVxuXHRcdFx0c3dpdGNoICh0b2tlbi5raW5kKSB7XG5cdFx0XHRcdGNhc2UgR19CcmFja2V0OlxuXHRcdFx0XHRcdGFjYyA9IENhbGwuc3ViKGxvYywgY2F0KGFjYywgcGFyc2VFeHByUGFydHMoc2xpY2UpKSlcblx0XHRcdFx0XHRjb250aW51ZVxuXHRcdFx0XHRjYXNlIEdfUGFyZW50aGVzaXM6XG5cdFx0XHRcdFx0Y2hlY2tFbXB0eShzbGljZSwgKCkgPT5cblx0XHRcdFx0XHRcdGBVc2UgJHtjb2RlKCcoYSBiKScpfSwgbm90ICR7Y29kZSgnYShiKScpfWApXG5cdFx0XHRcdFx0YWNjID0gbmV3IENhbGwobG9jLCBhY2MsIFtdKVxuXHRcdFx0XHRcdGNvbnRpbnVlXG5cdFx0XHRcdGNhc2UgR19RdW90ZTpcblx0XHRcdFx0XHRhY2MgPSBuZXcgUXVvdGVUZW1wbGF0ZShsb2MsIGFjYywgcGFyc2VRdW90ZShzbGljZSkpXG5cdFx0XHRcdFx0Y29udGludWVcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdH1cblx0XHR9XG5cdFx0Y29udGV4dC5mYWlsKHRva2VuLmxvYywgYEV4cGVjdGVkIG1lbWJlciBvciBzdWIsIG5vdCAke3Rva2VufWApXG5cdH1cblx0cmV0dXJuIGFjY1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc3JjIn0=
