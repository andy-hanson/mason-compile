{"version":3,"sources":["private/verify/verifyModule.js"],"names":[],"mappings":"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","file":"private/verify/verifyModule.js","sourcesContent":["(function (factory) {\n    if (typeof module === 'object' && typeof module.exports === 'object') {\n        var v = factory(require, exports); if (v !== undefined) module.exports = v;\n    }\n    else if (typeof define === 'function' && define.amd) {\n        define([\"require\", \"exports\", 'op/Op', '../context', '../ast/Block', '../util', './autoBlockKind', './context', './locals', './SK', './verifyLines', './verifyLocalDeclare', './verifyVal'], factory);\n    }\n})(function (require, exports) {\n    \"use strict\";\n    var Op_1 = require('op/Op');\n    var context_1 = require('../context');\n    var Block_1 = require('../ast/Block');\n    var util_1 = require('../util');\n    var autoBlockKind_1 = require('./autoBlockKind');\n    var context_2 = require('./context');\n    var locals_1 = require('./locals');\n    var SK_1 = require('./SK');\n    var verifyLines_1 = require('./verifyLines');\n    var verifyLocalDeclare_1 = require('./verifyLocalDeclare');\n    var verifyVal_1 = require('./verifyVal');\n    function verifyModule({ imports, lines, loc }) {\n        for (const _ of imports)\n            verifyImport(_);\n        context_2.withName(context_1.pathOptions.moduleName, () => {\n            verifyModuleLines(lines, loc);\n        });\n    }\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = verifyModule;\n    function verifyImport({ imported, opImportDefault }) {\n        function addUseLocal(ld) {\n            const prev = context_2.locals.get(ld.name);\n            context_1.check(prev === undefined, ld.loc, _ => _.duplicateImport(ld.name, prev.loc));\n            verifyLocalDeclare_1.verifyLocalDeclare(ld);\n            locals_1.setLocal(ld);\n        }\n        for (const _ of imported)\n            addUseLocal(_);\n        Op_1.opEach(opImportDefault, addUseLocal);\n    }\n    function verifyModuleLines(lines, loc) {\n        context_2.results.moduleKind = Op_1.caseOp(autoBlockKind_1.opBlockBuildKind(lines, loc), buildKind => {\n            if (buildKind === 5) {\n                for (const line of lines)\n                    if (line instanceof Block_1.ObjEntry)\n                        context_2.results.objEntryExports.add(line);\n                verifyLines_1.default(lines);\n                return 2;\n            }\n            else {\n                verifyLines_1.verifyBuiltLines(lines, loc);\n                return buildKind === 3 ? 3 : 4;\n            }\n        }, () => {\n            if (util_1.isEmpty(lines))\n                return 0;\n            else {\n                const l = util_1.last(lines);\n                const lastSK = SK_1.getLineSK(l);\n                if (lastSK === 0) {\n                    verifyLines_1.default(lines);\n                    return 0;\n                }\n                else {\n                    const newLocals = verifyLines_1.default(util_1.rtail(lines));\n                    locals_1.plusLocals(newLocals, () => verifyVal_1.ensureValAndVerify(l));\n                    return 1;\n                }\n            }\n        });\n    }\n});\n"],"sourceRoot":"/source/"}