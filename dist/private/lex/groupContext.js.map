{"version":3,"sources":["private/lex/groupContext.js"],"names":[],"mappings":"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","file":"private/lex/groupContext.js","sourcesContent":["(function (factory) {\n    if (typeof module === 'object' && typeof module.exports === 'object') {\n        var v = factory(require, exports); if (v !== undefined) module.exports = v;\n    }\n    else if (typeof define === 'function' && define.amd) {\n        define([\"require\", \"exports\", 'esast/lib/Loc', '../context', '../Token', '../util'], factory);\n    }\n})(function (require, exports) {\n    \"use strict\";\n    var Loc_1 = require('esast/lib/Loc');\n    var context_1 = require('../context');\n    var Token_1 = require('../Token');\n    var util_1 = require('../util');\n    let groupStack;\n    function setupGroupContext() {\n        exports.curGroup = new Token_1.GroupBlock(new Loc_1.default(Loc_1.Pos.start, null), []);\n        groupStack = [];\n    }\n    exports.setupGroupContext = setupGroupContext;\n    function tearDownGroupContext(endPos) {\n        closeLine(endPos);\n        util_1.assert(util_1.isEmpty(groupStack));\n        exports.curGroup.loc.end = endPos;\n        const res = exports.curGroup;\n        groupStack = exports.curGroup = null;\n        return res;\n    }\n    exports.tearDownGroupContext = tearDownGroupContext;\n    function addToCurrentGroup(token) {\n        exports.curGroup.subTokens.push(token);\n    }\n    exports.addToCurrentGroup = addToCurrentGroup;\n    function dropGroup() {\n        exports.curGroup = groupStack.pop();\n    }\n    function openGroup(openPos, groupType) {\n        groupStack.push(exports.curGroup);\n        exports.curGroup = new groupType(new Loc_1.default(openPos, null), []);\n    }\n    exports.openGroup = openGroup;\n    function maybeCloseGroup(closePos, closeType) {\n        if (exports.curGroup instanceof closeType)\n            closeGroupNoCheck(closePos, closeType);\n    }\n    exports.maybeCloseGroup = maybeCloseGroup;\n    function closeGroup(closePos, closeType) {\n        context_1.check(exports.curGroup instanceof closeType, closePos, _ => _.mismatchedGroupClose(closeType, exports.curGroup));\n        closeGroupNoCheck(closePos, closeType);\n    }\n    exports.closeGroup = closeGroup;\n    function closeGroupNoCheck(closePos, closeType) {\n        const justClosed = exports.curGroup;\n        dropGroup();\n        justClosed.loc.end = closePos;\n        switch (closeType) {\n            case Token_1.GroupSpace: {\n                const size = justClosed.subTokens.length;\n                if (size === 0)\n                    context_1.warn(justClosed.loc, _ => _.extraSpace);\n                else\n                    addToCurrentGroup(size === 1 ? justClosed.subTokens[0] : justClosed);\n                break;\n            }\n            case Token_1.GroupLine:\n                if (!util_1.isEmpty(justClosed.subTokens))\n                    addToCurrentGroup(justClosed);\n                break;\n            case Token_1.GroupBlock:\n                context_1.check(!util_1.isEmpty(justClosed.subTokens), closePos, _ => _.emptyBlock);\n                addToCurrentGroup(justClosed);\n                break;\n            default:\n                addToCurrentGroup(justClosed);\n        }\n    }\n    function closeSpaceOKIfEmpty(pos) {\n        util_1.assert(exports.curGroup instanceof Token_1.GroupSpace);\n        if (exports.curGroup.subTokens.length === 0)\n            dropGroup();\n        else\n            closeGroupNoCheck(pos, Token_1.GroupSpace);\n    }\n    exports.closeSpaceOKIfEmpty = closeSpaceOKIfEmpty;\n    function openParenthesis(loc) {\n        openGroup(loc.start, Token_1.GroupParenthesis);\n        openGroup(loc.end, Token_1.GroupSpace);\n    }\n    exports.openParenthesis = openParenthesis;\n    function openInterpolation(loc) {\n        openGroup(loc.start, Token_1.GroupInterpolation);\n        openGroup(loc.end, Token_1.GroupSpace);\n    }\n    exports.openInterpolation = openInterpolation;\n    function closeInterpolationOrParenthesis(loc) {\n        closeGroupNoCheck(loc.start, Token_1.GroupSpace);\n        const group = exports.curGroup;\n        closeGroup(loc.end, group.type);\n        return group instanceof Token_1.GroupInterpolation;\n    }\n    exports.closeInterpolationOrParenthesis = closeInterpolationOrParenthesis;\n    function closeGroupsForDedent(pos) {\n        closeLine(pos);\n        closeGroup(pos, Token_1.GroupBlock);\n        while (exports.curGroup instanceof Token_1.GroupParenthesis || exports.curGroup instanceof Token_1.GroupSpace)\n            closeGroupNoCheck(pos, exports.curGroup.type);\n    }\n    exports.closeGroupsForDedent = closeGroupsForDedent;\n    function openLine(pos) {\n        openGroup(pos, Token_1.GroupLine);\n        openGroup(pos, Token_1.GroupSpace);\n    }\n    exports.openLine = openLine;\n    function closeLine(pos) {\n        if (exports.curGroup instanceof Token_1.GroupSpace)\n            closeSpaceOKIfEmpty(pos);\n        closeGroup(pos, Token_1.GroupLine);\n    }\n    exports.closeLine = closeLine;\n    function space(loc) {\n        maybeCloseGroup(loc.start, Token_1.GroupSpace);\n        openGroup(loc.end, Token_1.GroupSpace);\n    }\n    exports.space = space;\n});\n"],"sourceRoot":"/source/"}