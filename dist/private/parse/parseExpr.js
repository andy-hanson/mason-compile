if (typeof define !== 'function') var define = require('amdefine')(module);define(['exports', 'esast/dist/Loc', '../../CompileError', '../context', '../MsAst', '../Token', '../util', './checks', './parse*', './parseBlock', './parseCase', './parseFor', './parseFun', './parseLocalDeclares'], function (exports, _esastDistLoc, _CompileError, _context, _MsAst, _Token, _util, _checks, _parse, _parseBlock, _parseCase, _parseFor, _parseFun, _parseLocalDeclares) {
	'use strict';

	Object.defineProperty(exports, '__esModule', {
		value: true
	});

	var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

	var _Loc = _interopRequireDefault(_esastDistLoc);

	var _parseCase2 = _interopRequireDefault(_parseCase);

	var _parseFun2 = _interopRequireDefault(_parseFun);

	exports.default = tokens => (0, _util.ifElse)(tokens.opSplitManyWhere(_ => (0, _Token.isKeyword)(_Token.KW_ObjAssign, _)), splits => {
		// Short object form, such as (a. 1, b. 2)
		const first = splits[0].before;
		(0, _checks.checkNonEmpty)(first, () => `Unexpected ${ splits[0].at }`);
		const tokensCaller = first.rtail();

		const pairs = [];
		for (let i = 0; i < splits.length - 1; i = i + 1) {
			const name = splits[i].before.last();
			(0, _context.check)(name instanceof _Token.Name, name.loc, () => `Expected a name, not ${ name }`);
			const tokensValue = i === splits.length - 2 ? splits[i + 1].before : splits[i + 1].before.rtail();
			const value = parseExprPlain(tokensValue);
			const loc = new _Loc.default(name.loc.start, tokensValue.loc.end);
			pairs.push(new _MsAst.ObjPair(loc, name.name, value));
		}
		const val = new _MsAst.ObjSimple(tokens.loc, pairs);
		if (tokensCaller.isEmpty()) return val;else {
			const parts = parseExprParts(tokensCaller);
			return new _MsAst.Call(tokens.loc, (0, _util.head)(parts), (0, _util.cat)((0, _util.tail)(parts), val));
		}
	}, () => parseExprPlain(tokens));

	const parseExprParts = tokens => {
		const opSplit = tokens.opSplitOnceWhere(token => {
			if (token instanceof _Token.Keyword) switch (token.kind) {
				case _Token.KW_And:case _Token.KW_CaseVal:case _Token.KW_Class:case _Token.KW_Cond:case _Token.KW_ExceptVal:
				case _Token.KW_ForBag:case _Token.KW_ForVal:case _Token.KW_Fun:case _Token.KW_FunDo:case _Token.KW_FunGen:
				case _Token.KW_FunGenDo:case _Token.KW_FunThis:case _Token.KW_FunThisDo:case _Token.KW_FunThisGen:
				case _Token.KW_FunThisGenDo:case _Token.KW_IfVal:case _Token.KW_New:case _Token.KW_Not:case _Token.KW_Or:
				case _Token.KW_SuperVal:case _Token.KW_SwitchVal:case _Token.KW_UnlessVal:case _Token.KW_With:
				case _Token.KW_Yield:case _Token.KW_YieldTo:
					return true;
				default:
					return false;
			}
			return false;
		});
		return (0, _util.ifElse)(opSplit, _ref => {
			let before = _ref.before;
			let at = _ref.at;
			let after = _ref.after;

			const getLast = () => {
				switch (at.kind) {
					case _Token.KW_And:case _Token.KW_Or:
						return new _MsAst.Logic(at.loc, at.kind === _Token.KW_And ? _MsAst.L_And : _MsAst.L_Or, parseExprParts(after));
					case _Token.KW_CaseVal:
						return (0, _parseCase2.default)(true, false, after);
					case _Token.KW_Class:
						return (0, _parse.parseClass)(after);
					case _Token.KW_Cond:
						return parseCond(after);
					case _Token.KW_ExceptVal:
						return (0, _parse.parseExcept)(_Token.KW_ExceptVal, after);
					case _Token.KW_ForBag:
						return (0, _parseFor.parseForBag)(after);
					case _Token.KW_ForVal:
						return (0, _parseFor.parseForVal)(after);
					case _Token.KW_Fun:case _Token.KW_FunDo:case _Token.KW_FunGen:case _Token.KW_FunGenDo:
					case _Token.KW_FunThis:case _Token.KW_FunThisDo:case _Token.KW_FunThisGen:
					case _Token.KW_FunThisGenDo:
						return (0, _parseFun2.default)(at.kind, after);
					case _Token.KW_IfVal:case _Token.KW_UnlessVal:
						{
							var _beforeAndBlock = (0, _parseBlock.beforeAndBlock)(after);

							var _beforeAndBlock2 = _slicedToArray(_beforeAndBlock, 2);

							const before = _beforeAndBlock2[0];
							const block = _beforeAndBlock2[1];

							return new _MsAst.ConditionalVal(tokens.loc, parseExprPlain(before), (0, _parseBlock.parseBlockVal)(block), at.kind === _Token.KW_UnlessVal);
						}
					case _Token.KW_New:
						{
							const parts = parseExprParts(after);
							return new _MsAst.New(at.loc, parts[0], (0, _util.tail)(parts));
						}
					case _Token.KW_Not:
						return new _MsAst.Not(at.loc, parseExprPlain(after));
					case _Token.KW_SuperVal:
						return new _MsAst.SuperCall(at.loc, parseExprParts(after));
					case _Token.KW_SwitchVal:
						return (0, _parse.parseSwitch)(true, false, after);
					case _Token.KW_With:
						return parseWith(after);
					case _Token.KW_Yield:
						return new _MsAst.Yield(at.loc, (0, _util.opIf)(!after.isEmpty(), () => parseExprPlain(after)));
					case _Token.KW_YieldTo:
						return new _MsAst.YieldTo(at.loc, parseExprPlain(after));
					default:
						throw new Error(at.kind);
				}
			};
			return (0, _util.cat)(before.map(_parse.parseSingle), getLast());
		}, () => tokens.map(_parse.parseSingle));
	};

	exports.parseExprParts = parseExprParts;
	const parseExprPlain = tokens => {
		const parts = parseExprParts(tokens);
		switch (parts.length) {
			case 0:
				(0, _context.fail)(tokens.loc, 'Expected an expression, got nothing.');
			case 1:
				return (0, _util.head)(parts);
			default:
				return new _MsAst.Call(tokens.loc, (0, _util.head)(parts), (0, _util.tail)(parts));
		}
	},
	      parseCond = tokens => {
		const parts = parseExprParts(tokens);
		(0, _context.check)(parts.length === 3, tokens.loc, () => `${ (0, _CompileError.code)('cond') } takes exactly 3 arguments.`);
		return new _MsAst.Cond(tokens.loc, parts[0], parts[1], parts[2]);
	},
	      parseWith = tokens => {
		var _beforeAndBlock3 = (0, _parseBlock.beforeAndBlock)(tokens);

		var _beforeAndBlock32 = _slicedToArray(_beforeAndBlock3, 2);

		const before = _beforeAndBlock32[0];
		const block = _beforeAndBlock32[1];

		var _ifElse = (0, _util.ifElse)(before.opSplitOnceWhere(_ => (0, _Token.isKeyword)(_Token.KW_As, _)), _ref2 => {
			let before = _ref2.before;
			let after = _ref2.after;

			(0, _context.check)(after.size() === 1, () => `Expected only 1 token after ${ (0, _CompileError.code)('as') }.`);
			return [parseExprPlain(before), (0, _parseLocalDeclares.parseLocalDeclare)(after.head())];
		}, () => [parseExprPlain(before), new _MsAst.LocalDeclareFocus(tokens.loc)]);

		var _ifElse2 = _slicedToArray(_ifElse, 2);

		const val = _ifElse2[0];
		const declare = _ifElse2[1];

		return new _MsAst.With(tokens.loc, declare, val, (0, _parseBlock.parseBlockDo)(block));
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcnNlRXhwci5qcyIsInByaXZhdGUvcGFyc2UvcGFyc2VFeHByLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OzttQkNrQmUsTUFBTSxJQUNwQixVQVZrQixNQUFNLEVBVWpCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksV0FkN0IsU0FBUyxTQUUyQixZQUFZLEVBWUssQ0FBQyxDQUFDLENBQUMsRUFDOUQsTUFBTSxJQUFJOztBQUVULFFBQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUE7QUFDOUIsY0FiSyxhQUFhLEVBYUosS0FBSyxFQUFFLE1BQU0sQ0FBQyxXQUFXLEdBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBQyxDQUFDLENBQUMsQ0FBQTtBQUN4RCxRQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUE7O0FBRWxDLFFBQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQTtBQUNoQixPQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7QUFDakQsU0FBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQTtBQUNwQyxnQkEzQkksS0FBSyxFQTJCSCxJQUFJLG1CQXJCZ0MsSUFBSSxBQXFCcEIsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLE1BQ3JDLENBQUMscUJBQXFCLEdBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ2hDLFNBQU0sV0FBVyxHQUFHLENBQUMsS0FBSyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsR0FDMUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQ3BCLE1BQU0sQ0FBQyxDQUFDLEdBQUcs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OltudWxsLCJpbXBvcnQgTG9jIGZyb20gJ2VzYXN0L2Rpc3QvTG9jJ1xuaW1wb3J0IHtjb2RlfSBmcm9tICcuLi8uLi9Db21waWxlRXJyb3InXG5pbXBvcnQge2NoZWNrLCBmYWlsfSBmcm9tICcuLi9jb250ZXh0J1xuaW1wb3J0IHtDYWxsLCBDb25kLCBDb25kaXRpb25hbFZhbCwgTG9jYWxEZWNsYXJlRm9jdXMsIExvZ2ljLCBMX0FuZCwgTF9PciwgTmV3LCBOb3QsIE9ialBhaXIsXG5cdE9ialNpbXBsZSwgU3VwZXJDYWxsLCBXaXRoLCBZaWVsZCwgWWllbGRUb30gZnJvbSAnLi4vTXNBc3QnXG5pbXBvcnQge2lzS2V5d29yZCwgS2V5d29yZCwgS1dfQW5kLCBLV19BcywgS1dfQ2FzZVZhbCwgS1dfQ2xhc3MsIEtXX0NvbmQsIEtXX0V4Y2VwdFZhbCwgS1dfRm9yQmFnLFxuXHRLV19Gb3JWYWwsIEtXX0Z1biwgS1dfRnVuRG8sIEtXX0Z1bkdlbiwgS1dfRnVuR2VuRG8sIEtXX0Z1blRoaXMsIEtXX0Z1blRoaXNEbywgS1dfRnVuVGhpc0dlbixcblx0S1dfRnVuVGhpc0dlbkRvLCBLV19JZlZhbCwgS1dfTmV3LCBLV19Ob3QsIEtXX09iakFzc2lnbiwgS1dfT3IsIEtXX1N1cGVyVmFsLCBLV19Td2l0Y2hWYWwsXG5cdEtXX1VubGVzc1ZhbCwgS1dfV2l0aCwgS1dfWWllbGQsIEtXX1lpZWxkVG8sIE5hbWV9IGZyb20gJy4uL1Rva2VuJ1xuaW1wb3J0IHtjYXQsIGhlYWQsIGlmRWxzZSwgb3BJZiwgdGFpbH0gZnJvbSAnLi4vdXRpbCdcbmltcG9ydCB7Y2hlY2tOb25FbXB0eX0gZnJvbSAnLi9jaGVja3MnXG5pbXBvcnQge3BhcnNlQ2xhc3MsIHBhcnNlRXhjZXB0LCBwYXJzZVNpbmdsZSwgcGFyc2VTd2l0Y2h9IGZyb20gJy4vcGFyc2UqJ1xuaW1wb3J0IHtiZWZvcmVBbmRCbG9jaywgcGFyc2VCbG9ja0RvLCBwYXJzZUJsb2NrVmFsfSBmcm9tICcuL3BhcnNlQmxvY2snXG5pbXBvcnQgcGFyc2VDYXNlIGZyb20gJy4vcGFyc2VDYXNlJ1xuaW1wb3J0IHtwYXJzZUZvckJhZywgcGFyc2VGb3JWYWx9IGZyb20gJy4vcGFyc2VGb3InXG5pbXBvcnQgcGFyc2VGdW4gZnJvbSAnLi9wYXJzZUZ1bidcbmltcG9ydCB7cGFyc2VMb2NhbERlY2xhcmV9IGZyb20gJy4vcGFyc2VMb2NhbERlY2xhcmVzJ1xuXG5leHBvcnQgZGVmYXVsdCB0b2tlbnMgPT5cblx0aWZFbHNlKHRva2Vucy5vcFNwbGl0TWFueVdoZXJlKF8gPT4gaXNLZXl3b3JkKEtXX09iakFzc2lnbiwgXykpLFxuXHRcdHNwbGl0cyA9PiB7XG5cdFx0XHQvLyBTaG9ydCBvYmplY3QgZm9ybSwgc3VjaCBhcyAoYS4gMSwgYi4gMilcblx0XHRcdGNvbnN0IGZpcnN0ID0gc3BsaXRzWzBdLmJlZm9yZVxuXHRcdFx0Y2hlY2tOb25FbXB0eShmaXJzdCwgKCkgPT4gYFVuZXhwZWN0ZWQgJHtzcGxpdHNbMF0uYXR9YClcblx0XHRcdGNvbnN0IHRva2Vuc0NhbGxlciA9IGZpcnN0LnJ0YWlsKClcblxuXHRcdFx0Y29uc3QgcGFpcnMgPSBbXVxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBzcGxpdHMubGVuZ3RoIC0gMTsgaSA9IGkgKyAxKSB7XG5cdFx0XHRcdGNvbnN0IG5hbWUgPSBzcGxpdHNbaV0uYmVmb3JlLmxhc3QoKVxuXHRcdFx0XHRjaGVjayhuYW1lIGluc3RhbmNlb2YgTmFtZSwgbmFtZS5sb2MsICgpID0+XG5cdFx0XHRcdFx0YEV4cGVjdGVkIGEgbmFtZSwgbm90ICR7bmFtZX1gKVxuXHRcdFx0XHRjb25zdCB0b2tlbnNWYWx1ZSA9IGkgPT09IHNwbGl0cy5sZW5ndGggLSAyID9cblx0XHRcdFx0XHRzcGxpdHNbaSArIDFdLmJlZm9yZSA6XG5cdFx0XHRcdFx0c3BsaXRzW2kgKyAxXS5iZWZvcmUucnRhaWwoKVxuXHRcdFx0XHRjb25zdCB2YWx1ZSA9IHBhcnNlRXhwclBsYWluKHRva2Vuc1ZhbHVlKVxuXHRcdFx0XHRjb25zdCBsb2MgPSBuZXcgTG9jKG5hbWUubG9jLnN0YXJ0LCB0b2tlbnNWYWx1ZS5sb2MuZW5kKVxuXHRcdFx0XHRwYWlycy5wdXNoKG5ldyBPYmpQYWlyKGxvYywgbmFtZS5uYW1lLCB2YWx1ZSkpXG5cdFx0XHR9XG5cdFx0XHRjb25zdCB2YWwgPSBuZXcgT2JqU2ltcGxlKHRva2Vucy5sb2MsIHBhaXJzKVxuXHRcdFx0aWYgKHRva2Vuc0NhbGxlci5pc0VtcHR5KCkpXG5cdFx0XHRcdHJldHVybiB2YWxcblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRjb25zdCBwYXJ0cyA9IHBhcnNlRXhwclBhcnRzKHRva2Vuc0NhbGxlcilcblx0XHRcdFx0cmV0dXJuIG5ldyBDYWxsKHRva2Vucy5sb2MsIGhlYWQocGFydHMpLCBjYXQodGFpbChwYXJ0cyksIHZhbCkpXG5cdFx0XHR9XG5cdFx0fSxcblx0XHQoKSA9PiBwYXJzZUV4cHJQbGFpbih0b2tlbnMpKVxuXG5leHBvcnQgY29uc3QgcGFyc2VFeHByUGFydHMgPSB0b2tlbnMgPT4ge1xuXHRjb25zdCBvcFNwbGl0ID0gdG9rZW5zLm9wU3BsaXRPbmNlV2hlcmUodG9rZW4gPT4ge1xuXHRcdGlmICh0b2tlbiBpbnN0YW5jZW9mIEtleXdvcmQpXG5cdFx0XHRzd2l0Y2ggKHRva2VuLmtpbmQpIHtcblx0XHRcdFx0Y2FzZSBLV19BbmQ6IGNhc2UgS1dfQ2FzZVZhbDogY2FzZSBLV19DbGFzczogY2FzZSBLV19Db25kOiBjYXNlIEtXX0V4Y2VwdFZhbDpcblx0XHRcdFx0Y2FzZSBLV19Gb3JCYWc6IGNhc2UgS1dfRm9yVmFsOiBjYXNlIEtXX0Z1bjogY2FzZSBLV19GdW5EbzogY2FzZSBLV19GdW5HZW46XG5cdFx0XHRcdGNhc2UgS1dfRnVuR2VuRG86IGNhc2UgS1dfRnVuVGhpczogY2FzZSBLV19GdW5UaGlzRG86IGNhc2UgS1dfRnVuVGhpc0dlbjpcblx0XHRcdFx0Y2FzZSBLV19GdW5UaGlzR2VuRG86IGNhc2UgS1dfSWZWYWw6IGNhc2UgS1dfTmV3OiBjYXNlIEtXX05vdDogY2FzZSBLV19Pcjpcblx0XHRcdFx0Y2FzZSBLV19TdXBlclZhbDogY2FzZSBLV19Td2l0Y2hWYWw6IGNhc2UgS1dfVW5sZXNzVmFsOiBjYXNlIEtXX1dpdGg6XG5cdFx0XHRcdGNhc2UgS1dfWWllbGQ6IGNhc2UgS1dfWWllbGRUbzpcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZVxuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdHJldHVybiBmYWxzZVxuXHRcdFx0fVxuXHRcdHJldHVybiBmYWxzZVxuXHR9KVxuXHRyZXR1cm4gaWZFbHNlKG9wU3BsaXQsXG5cdFx0KHtiZWZvcmUsIGF0LCBhZnRlcn0pID0+IHtcblx0XHRcdGNvbnN0IGdldExhc3QgPSAoKSA9PiB7XG5cdFx0XHRcdHN3aXRjaCAoYXQua2luZCkge1xuXHRcdFx0XHRcdGNhc2UgS1dfQW5kOiBjYXNlIEtXX09yOlxuXHRcdFx0XHRcdFx0cmV0dXJuIG5ldyBMb2dpYyhhdC5sb2MsIGF0LmtpbmQgPT09IEtXX0FuZCA/IExfQW5kIDogTF9Pcixcblx0XHRcdFx0XHRcdFx0cGFyc2VFeHByUGFydHMoYWZ0ZXIpKVxuXHRcdFx0XHRcdGNhc2UgS1dfQ2FzZVZhbDpcblx0XHRcdFx0XHRcdHJldHVybiBwYXJzZUNhc2UodHJ1ZSwgZmFsc2UsIGFmdGVyKVxuXHRcdFx0XHRcdGNhc2UgS1dfQ2xhc3M6XG5cdFx0XHRcdFx0XHRyZXR1cm4gcGFyc2VDbGFzcyhhZnRlcilcblx0XHRcdFx0XHRjYXNlIEtXX0NvbmQ6XG5cdFx0XHRcdFx0XHRyZXR1cm4gcGFyc2VDb25kKGFmdGVyKVxuXHRcdFx0XHRcdGNhc2UgS1dfRXhjZXB0VmFsOlxuXHRcdFx0XHRcdFx0cmV0dXJuIHBhcnNlRXhjZXB0KEtXX0V4Y2VwdFZhbCwgYWZ0ZXIpXG5cdFx0XHRcdFx0Y2FzZSBLV19Gb3JCYWc6XG5cdFx0XHRcdFx0XHRyZXR1cm4gcGFyc2VGb3JCYWcoYWZ0ZXIpXG5cdFx0XHRcdFx0Y2FzZSBLV19Gb3JWYWw6XG5cdFx0XHRcdFx0XHRyZXR1cm4gcGFyc2VGb3JWYWwoYWZ0ZXIpXG5cdFx0XHRcdFx0Y2FzZSBLV19GdW46IGNhc2UgS1dfRnVuRG86IGNhc2UgS1dfRnVuR2VuOiBjYXNlIEtXX0Z1bkdlbkRvOlxuXHRcdFx0XHRcdGNhc2UgS1dfRnVuVGhpczogY2FzZSBLV19GdW5UaGlzRG86IGNhc2UgS1dfRnVuVGhpc0dlbjpcblx0XHRcdFx0XHRjYXNlIEtXX0Z1blRoaXNHZW5Ebzpcblx0XHRcdFx0XHRcdHJldHVybiBwYXJzZUZ1bihhdC5raW5kLCBhZnRlcilcblx0XHRcdFx0XHRjYXNlIEtXX0lmVmFsOiBjYXNlIEtXX1VubGVzc1ZhbDoge1xuXHRcdFx0XHRcdFx0Y29uc3QgW2JlZm9yZSwgYmxvY2tdID0gYmVmb3JlQW5kQmxvY2soYWZ0ZXIpXG5cdFx0XHRcdFx0XHRyZXR1cm4gbmV3IENvbmRpdGlvbmFsVmFsKHRva2Vucy5sb2MsXG5cdFx0XHRcdFx0XHRcdHBhcnNlRXhwclBsYWluKGJlZm9yZSksXG5cdFx0XHRcdFx0XHRcdHBhcnNlQmxvY2tWYWwoYmxvY2spLFxuXHRcdFx0XHRcdFx0XHRhdC5raW5kID09PSBLV19Vbmxlc3NWYWwpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGNhc2UgS1dfTmV3OiB7XG5cdFx0XHRcdFx0XHRjb25zdCBwYXJ0cyA9IHBhcnNlRXhwclBhcnRzKGFmdGVyKVxuXHRcdFx0XHRcdFx0cmV0dXJuIG5ldyBOZXcoYXQubG9jLCBwYXJ0c1swXSwgdGFpbChwYXJ0cykpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGNhc2UgS1dfTm90OlxuXHRcdFx0XHRcdFx0cmV0dXJuIG5ldyBOb3QoYXQubG9jLCBwYXJzZUV4cHJQbGFpbihhZnRlcikpXG5cdFx0XHRcdFx0Y2FzZSBLV19TdXBlclZhbDpcblx0XHRcdFx0XHRcdHJldHVybiBuZXcgU3VwZXJDYWxsKGF0LmxvYywgcGFyc2VFeHByUGFydHMoYWZ0ZXIpKVxuXHRcdFx0XHRcdGNhc2UgS1dfU3dpdGNoVmFsOlxuXHRcdFx0XHRcdFx0cmV0dXJuIHBhcnNlU3dpdGNoKHRydWUsIGZhbHNlLCBhZnRlcilcblx0XHRcdFx0XHRjYXNlIEtXX1dpdGg6XG5cdFx0XHRcdFx0XHRyZXR1cm4gcGFyc2VXaXRoKGFmdGVyKVxuXHRcdFx0XHRcdGNhc2UgS1dfWWllbGQ6XG5cdFx0XHRcdFx0XHRyZXR1cm4gbmV3IFlpZWxkKGF0LmxvYyxcblx0XHRcdFx0XHRcdFx0b3BJZighYWZ0ZXIuaXNFbXB0eSgpLCAoKSA9PiBwYXJzZUV4cHJQbGFpbihhZnRlcikpKVxuXHRcdFx0XHRcdGNhc2UgS1dfWWllbGRUbzpcblx0XHRcdFx0XHRcdHJldHVybiBuZXcgWWllbGRUbyhhdC5sb2MsIHBhcnNlRXhwclBsYWluKGFmdGVyKSlcblx0XHRcdFx0XHRkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoYXQua2luZClcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGNhdChiZWZvcmUubWFwKHBhcnNlU2luZ2xlKSwgZ2V0TGFzdCgpKVxuXHRcdH0sXG5cdFx0KCkgPT4gdG9rZW5zLm1hcChwYXJzZVNpbmdsZSkpXG59XG5cbmNvbnN0XG5cdHBhcnNlRXhwclBsYWluID0gdG9rZW5zID0+IHtcblx0XHRjb25zdCBwYXJ0cyA9IHBhcnNlRXhwclBhcnRzKHRva2Vucylcblx0XHRzd2l0Y2ggKHBhcnRzLmxlbmd0aCkge1xuXHRcdFx0Y2FzZSAwOlxuXHRcdFx0XHRmYWlsKHRva2Vucy5sb2MsICdFeHBlY3RlZCBhbiBleHByZXNzaW9uLCBnb3Qgbm90aGluZy4nKVxuXHRcdFx0Y2FzZSAxOlxuXHRcdFx0XHRyZXR1cm4gaGVhZChwYXJ0cylcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHJldHVybiBuZXcgQ2FsbCh0b2tlbnMubG9jLCBoZWFkKHBhcnRzKSwgdGFpbChwYXJ0cykpXG5cdFx0fVxuXHR9LFxuXG5cdHBhcnNlQ29uZCA9IHRva2VucyA9PiB7XG5cdFx0Y29uc3QgcGFydHMgPSBwYXJzZUV4cHJQYXJ0cyh0b2tlbnMpXG5cdFx0Y2hlY2socGFydHMubGVuZ3RoID09PSAzLCB0b2tlbnMubG9jLCAoKSA9PiBgJHtjb2RlKCdjb25kJyl9IHRha2VzIGV4YWN0bHkgMyBhcmd1bWVudHMuYClcblx0XHRyZXR1cm4gbmV3IENvbmQodG9rZW5zLmxvYywgcGFydHNbMF0sIHBhcnRzWzFdLCBwYXJ0c1syXSlcblx0fSxcblxuXHRwYXJzZVdpdGggPSB0b2tlbnMgPT4ge1xuXHRcdGNvbnN0IFtiZWZvcmUsIGJsb2NrXSA9IGJlZm9yZUFuZEJsb2NrKHRva2VucylcblxuXHRcdGNvbnN0IFt2YWwsIGRlY2xhcmVdID0gaWZFbHNlKGJlZm9yZS5vcFNwbGl0T25jZVdoZXJlKF8gPT4gaXNLZXl3b3JkKEtXX0FzLCBfKSksXG5cdFx0XHQoe2JlZm9yZSwgYWZ0ZXJ9KSA9PiB7XG5cdFx0XHRcdGNoZWNrKGFmdGVyLnNpemUoKSA9PT0gMSwgKCkgPT5cblx0XHRcdFx0XHRgRXhwZWN0ZWQgb25seSAxIHRva2VuIGFmdGVyICR7Y29kZSgnYXMnKX0uYClcblx0XHRcdFx0cmV0dXJuIFtwYXJzZUV4cHJQbGFpbihiZWZvcmUpLCBwYXJzZUxvY2FsRGVjbGFyZShhZnRlci5oZWFkKCkpXVxuXHRcdFx0fSxcblx0XHRcdCgpID0+IFtwYXJzZUV4cHJQbGFpbihiZWZvcmUpLCBuZXcgTG9jYWxEZWNsYXJlRm9jdXModG9rZW5zLmxvYyldKVxuXG5cdFx0cmV0dXJuIG5ldyBXaXRoKHRva2Vucy5sb2MsIGRlY2xhcmUsIHZhbCwgcGFyc2VCbG9ja0RvKGJsb2NrKSlcblx0fVxuIl0sInNvdXJjZVJvb3QiOiIvc3JjIn0=
