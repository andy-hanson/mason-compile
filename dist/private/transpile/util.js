if (typeof define !== 'function') var define = require('amdefine')(module);define(['exports', 'esast/dist/ast', 'esast/dist/mangle-identifier', 'esast/dist/util', '../context', '../MsAst', '../util', './ast-constants', './ms-call'], function (exports, _esastDistAst, _esastDistMangleIdentifier, _esastDistUtil, _context, _MsAst, _util, _astConstants, _msCall) {
	'use strict';

	Object.defineProperty(exports, '__esModule', {
		value: true
	});
	exports.t0 = t0;
	exports.t1 = t1;
	exports.t2 = t2;
	exports.t3 = t3;
	exports.tLines = tLines;
	exports.accessLocalDeclare = accessLocalDeclare;
	exports.declare = declare;
	exports.idForDeclareCached = idForDeclareCached;
	exports.opTypeCheckForLocalDeclare = opTypeCheckForLocalDeclare;
	exports.throwErrorFromString = throwErrorFromString;
	exports.makeDeclarator = makeDeclarator;
	exports.maybeWrapInCheckContains = maybeWrapInCheckContains;
	exports.getMember = getMember;
	exports.doThrow = doThrow;
	exports.memberStringOrVal = memberStringOrVal;

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

	var _mangleIdentifier = _interopRequireDefault(_esastDistMangleIdentifier);

	function t0(expr) {
		return (0, _esastDistUtil.loc)(expr.transpile(), expr.loc);
	}

	function t1(expr, arg) {
		return (0, _esastDistUtil.loc)(expr.transpile(arg), expr.loc);
	}

	function t2(expr, arg, arg2) {
		return (0, _esastDistUtil.loc)(expr.transpile(arg, arg2));
	}

	function t3(expr, arg, arg2, arg3) {
		return (0, _esastDistUtil.loc)(expr.transpile(arg, arg2, arg3), expr.loc);
	}

	function tLines(exprs) {
		const out = [];
		for (const expr of exprs) {
			const ast = expr.transpile();
			if (ast instanceof Array)
				// Ignore produces 0 statements and Region produces many.
				for (const _ of ast) out.push((0, _esastDistUtil.toStatement)(_));else out.push((0, _esastDistUtil.loc)((0, _esastDistUtil.toStatement)(ast), expr.loc));
		}
		return out;
	}

	function accessLocalDeclare(localDeclare) {
		const id = idForDeclareCached(localDeclare);
		return localDeclare.isLazy() ? (0, _msCall.msUnlazy)(id) : new _esastDistAst.Identifier(id.name);
	}

	function declare(localDeclare, val) {
		return new _esastDistAst.VariableDeclaration('const', [new _esastDistAst.VariableDeclarator(idForDeclareCached(localDeclare), val)]);
	}

	const declareToId = new WeakMap();

	function idForDeclareCached(localDeclare) {
		let _ = declareToId.get(localDeclare);
		if (_ === undefined) {
			_ = new _esastDistAst.Identifier((0, _mangleIdentifier.default)(localDeclare.name));
			declareToId.set(localDeclare, _);
		}
		return _;
	}

	function opTypeCheckForLocalDeclare(localDeclare) {
		// TODO: Way to typecheck lazies
		return (0, _util.opIf)(!localDeclare.isLazy(), () => (0, _util.opMap)(localDeclare.opType, type => new _esastDistAst.ExpressionStatement((0, _msCall.msCheckContains)(t0(type), accessLocalDeclare(localDeclare), new _esastDistAst.Literal(localDeclare.name)))));
	}

	function throwErrorFromString(message) {
		// TODO:ES6 Should be able to use IdError
		return new _esastDistAst.ThrowStatement(new _esastDistAst.NewExpression(new _esastDistAst.Identifier('Error'), [new _esastDistAst.Literal(message)]));
	}

	function makeDeclarator(assignee, value, valueIsAlreadyLazy) {
		const name = assignee.name;
		const opType = assignee.opType;

		const isLazy = assignee.isLazy();
		// TODO: assert(assignee.opType === null)
		// or TODO: Allow type check on lazy value?
		value = isLazy ? value : maybeWrapInCheckContains(value, opType, name);
		const val = isLazy && !valueIsAlreadyLazy ? (0, _msCall.lazyWrap)(value) : value;
		(0, _util.assert)(isLazy || !valueIsAlreadyLazy);
		return new _esastDistAst.VariableDeclarator(idForDeclareCached(assignee), val);
	}

	function maybeWrapInCheckContains(ast, opType, name) {
		return _context.options.includeChecks() && opType !== null ? (0, _msCall.msCheckContains)(t0(opType), ast, new _esastDistAst.Literal(name)) : ast;
	}

	function getMember(astObject, gotName, isLazy, isModule) {
		return isLazy ? (0, _msCall.msLazyGet)(astObject, new _esastDistAst.Literal(gotName)) : isModule && _context.options.includeChecks() ? (0, _msCall.msGet)(astObject, new _esastDistAst.Literal(gotName)) : (0, _esastDistUtil.member)(astObject, gotName);
	}

	function doThrow(thrown) {
		return new _esastDistAst.ThrowStatement(thrown instanceof _MsAst.Quote ? new _esastDistAst.NewExpression(_astConstants.GlobalError, [t0(thrown)]) : t0(thrown));
	}

	function memberStringOrVal(object, memberName) {
		return typeof memberName === 'string' ? (0, _esastDistUtil.member)(object, memberName) : new _esastDistAst.MemberExpression(object, t0(memberName));
	}
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWwuanMiLCJwcml2YXRlL3RyYW5zcGlsZS91dGlsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ1dPLFVBQVMsRUFBRSxDQUFDLElBQUksRUFBRTtBQUN4QixTQUFPLG1CQVRBLEdBQUcsRUFTQyxJQUFJLENBQUMsU0FBUyxFQUFFLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0VBQ3RDOztBQUNNLFVBQVMsRUFBRSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUU7QUFDN0IsU0FBTyxtQkFaQSxHQUFHLEVBWUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7RUFDekM7O0FBQ00sVUFBUyxFQUFFLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUU7QUFDbkMsU0FBTyxtQkFmQSxHQUFHLEVBZUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQTtFQUNyQzs7QUFDTSxVQUFTLEVBQUUsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUU7QUFDekMsU0FBTyxtQkFsQkEsR0FBRyxFQWtCQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0VBQ3JEOztBQUNNLFVBQVMsTUFBTSxDQUFDLEtBQUssRUFBRTtBQUM3QixRQUFNLEdBQUcsR0FBRyxFQUFFLENBQUE7QUFDZCxPQUFLLE1BQU0sSUFBSSxJQUFJLEtBQUssRUFBRTtBQUN6QixTQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUE7QUFDNUIsT0FBSSxHQUFHLFlBQVksS0FBSzs7QUFFdkIsU0FBSyxNQUFNLENBQUMsSUFBSSxHQUFHLEVBQ2xCLEdBQUcsQ0FBQyxJQUFJLENBQUMs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RzNDLE1BQU0sRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQTtFQUM3QyIsImZpbGUiOiJwcml2YXRlL3RyYW5zcGlsZS91dGlsLmpzIiwic291cmNlc0NvbnRlbnQiOltudWxsLCJpbXBvcnQge0V4cHJlc3Npb25TdGF0ZW1lbnQsIElkZW50aWZpZXIsIExpdGVyYWwsIE1lbWJlckV4cHJlc3Npb24sIE5ld0V4cHJlc3Npb24sIFRocm93U3RhdGVtZW50LFxuXHRWYXJpYWJsZURlY2xhcmF0b3IsIFZhcmlhYmxlRGVjbGFyYXRpb259IGZyb20gJ2VzYXN0L2Rpc3QvYXN0J1xuaW1wb3J0IG1hbmdsZUlkZW50aWZpZXIgZnJvbSAnZXNhc3QvZGlzdC9tYW5nbGUtaWRlbnRpZmllcidcbmltcG9ydCB7bG9jLCB0b1N0YXRlbWVudH0gZnJvbSAnZXNhc3QvZGlzdC91dGlsJ1xuaW1wb3J0IHttZW1iZXJ9IGZyb20gJ2VzYXN0L2Rpc3QvdXRpbCdcbmltcG9ydCB7b3B0aW9uc30gZnJvbSAnLi4vY29udGV4dCdcbmltcG9ydCB7UXVvdGV9IGZyb20gJy4uL01zQXN0J1xuaW1wb3J0IHthc3NlcnQsIG9wSWYsIG9wTWFwfSBmcm9tICcuLi91dGlsJ1xuaW1wb3J0IHtHbG9iYWxFcnJvcn0gZnJvbSAnLi9hc3QtY29uc3RhbnRzJ1xuaW1wb3J0IHtsYXp5V3JhcCwgbXNDaGVja0NvbnRhaW5zLCBtc0dldCwgbXNMYXp5R2V0LCBtc1VubGF6eX0gZnJvbSAnLi9tcy1jYWxsJ1xuXG5leHBvcnQgZnVuY3Rpb24gdDAoZXhwcikge1xuXHRyZXR1cm4gbG9jKGV4cHIudHJhbnNwaWxlKCksIGV4cHIubG9jKVxufVxuZXhwb3J0IGZ1bmN0aW9uIHQxKGV4cHIsIGFyZykge1xuXHRyZXR1cm4gbG9jKGV4cHIudHJhbnNwaWxlKGFyZyksIGV4cHIubG9jKVxufVxuZXhwb3J0IGZ1bmN0aW9uIHQyKGV4cHIsIGFyZywgYXJnMikge1xuXHRyZXR1cm4gbG9jKGV4cHIudHJhbnNwaWxlKGFyZywgYXJnMikpXG59XG5leHBvcnQgZnVuY3Rpb24gdDMoZXhwciwgYXJnLCBhcmcyLCBhcmczKSB7XG5cdHJldHVybiBsb2MoZXhwci50cmFuc3BpbGUoYXJnLCBhcmcyLCBhcmczKSwgZXhwci5sb2MpXG59XG5leHBvcnQgZnVuY3Rpb24gdExpbmVzKGV4cHJzKSB7XG5cdGNvbnN0IG91dCA9IFtdXG5cdGZvciAoY29uc3QgZXhwciBvZiBleHBycykge1xuXHRcdGNvbnN0IGFzdCA9IGV4cHIudHJhbnNwaWxlKClcblx0XHRpZiAoYXN0IGluc3RhbmNlb2YgQXJyYXkpXG5cdFx0XHQvLyBJZ25vcmUgcHJvZHVjZXMgMCBzdGF0ZW1lbnRzIGFuZCBSZWdpb24gcHJvZHVjZXMgbWFueS5cblx0XHRcdGZvciAoY29uc3QgXyBvZiBhc3QpXG5cdFx0XHRcdG91dC5wdXNoKHRvU3RhdGVtZW50KF8pKVxuXHRcdGVsc2Vcblx0XHRcdG91dC5wdXNoKGxvYyh0b1N0YXRlbWVudChhc3QpLCBleHByLmxvYykpXG5cdH1cblx0cmV0dXJuIG91dFxufVxuXG5leHBvcnQgZnVuY3Rpb24gYWNjZXNzTG9jYWxEZWNsYXJlKGxvY2FsRGVjbGFyZSkge1xuXHRjb25zdCBpZCA9IGlkRm9yRGVjbGFyZUNhY2hlZChsb2NhbERlY2xhcmUpXG5cdHJldHVybiBsb2NhbERlY2xhcmUuaXNMYXp5KCkgPyBtc1VubGF6eShpZCkgOiBuZXcgSWRlbnRpZmllcihpZC5uYW1lKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVjbGFyZShsb2NhbERlY2xhcmUsIHZhbCkge1xuXHRyZXR1cm4gbmV3IFZhcmlhYmxlRGVjbGFyYXRpb24oJ2NvbnN0Jyxcblx0XHRbbmV3IFZhcmlhYmxlRGVjbGFyYXRvcihpZEZvckRlY2xhcmVDYWNoZWQobG9jYWxEZWNsYXJlKSwgdmFsKV0pXG59XG5cbmNvbnN0IGRlY2xhcmVUb0lkID0gbmV3IFdlYWtNYXAoKVxuZXhwb3J0IGZ1bmN0aW9uIGlkRm9yRGVjbGFyZUNhY2hlZChsb2NhbERlY2xhcmUpIHtcblx0bGV0IF8gPSBkZWNsYXJlVG9JZC5nZXQobG9jYWxEZWNsYXJlKVxuXHRpZiAoXyA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XyA9IG5ldyBJZGVudGlmaWVyKG1hbmdsZUlkZW50aWZpZXIobG9jYWxEZWNsYXJlLm5hbWUpKVxuXHRcdGRlY2xhcmVUb0lkLnNldChsb2NhbERlY2xhcmUsIF8pXG5cdH1cblx0cmV0dXJuIF9cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9wVHlwZUNoZWNrRm9yTG9jYWxEZWNsYXJlKGxvY2FsRGVjbGFyZSkge1xuXHQvLyBUT0RPOiBXYXkgdG8gdHlwZWNoZWNrIGxhemllc1xuXHRyZXR1cm4gb3BJZighbG9jYWxEZWNsYXJlLmlzTGF6eSgpLCAoKSA9PlxuXHRcdG9wTWFwKGxvY2FsRGVjbGFyZS5vcFR5cGUsIHR5cGUgPT5cblx0XHRcdG5ldyBFeHByZXNzaW9uU3RhdGVtZW50KG1zQ2hlY2tDb250YWlucyhcblx0XHRcdFx0dDAodHlwZSksXG5cdFx0XHRcdGFjY2Vzc0xvY2FsRGVjbGFyZShsb2NhbERlY2xhcmUpLFxuXHRcdFx0XHRuZXcgTGl0ZXJhbChsb2NhbERlY2xhcmUubmFtZSkpKSkpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0aHJvd0Vycm9yRnJvbVN0cmluZyhtZXNzYWdlKSB7XG5cdC8vIFRPRE86RVM2IFNob3VsZCBiZSBhYmxlIHRvIHVzZSBJZEVycm9yXG5cdHJldHVybiBuZXcgVGhyb3dTdGF0ZW1lbnQoXG5cdFx0bmV3IE5ld0V4cHJlc3Npb24obmV3IElkZW50aWZpZXIoJ0Vycm9yJyksIFtuZXcgTGl0ZXJhbChtZXNzYWdlKV0pKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFrZURlY2xhcmF0b3IoYXNzaWduZWUsIHZhbHVlLCB2YWx1ZUlzQWxyZWFkeUxhenkpIHtcblx0Y29uc3Qge25hbWUsIG9wVHlwZX0gPSBhc3NpZ25lZVxuXHRjb25zdCBpc0xhenkgPSBhc3NpZ25lZS5pc0xhenkoKVxuXHQvLyBUT0RPOiBhc3NlcnQoYXNzaWduZWUub3BUeXBlID09PSBudWxsKVxuXHQvLyBvciBUT0RPOiBBbGxvdyB0eXBlIGNoZWNrIG9uIGxhenkgdmFsdWU/XG5cdHZhbHVlID0gaXNMYXp5ID8gdmFsdWUgOiBtYXliZVdyYXBJbkNoZWNrQ29udGFpbnModmFsdWUsIG9wVHlwZSwgbmFtZSlcblx0Y29uc3QgdmFsID0gaXNMYXp5ICYmICF2YWx1ZUlzQWxyZWFkeUxhenkgPyBsYXp5V3JhcCh2YWx1ZSkgOiB2YWx1ZVxuXHRhc3NlcnQoaXNMYXp5IHx8ICF2YWx1ZUlzQWxyZWFkeUxhenkpXG5cdHJldHVybiBuZXcgVmFyaWFibGVEZWNsYXJhdG9yKGlkRm9yRGVjbGFyZUNhY2hlZChhc3NpZ25lZSksIHZhbClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1heWJlV3JhcEluQ2hlY2tDb250YWlucyhhc3QsIG9wVHlwZSwgbmFtZSkge1xuXHRyZXR1cm4gb3B0aW9ucy5pbmNsdWRlQ2hlY2tzKCkgJiYgb3BUeXBlICE9PSBudWxsID9cblx0XHRtc0NoZWNrQ29udGFpbnModDAob3BUeXBlKSwgYXN0LCBuZXcgTGl0ZXJhbChuYW1lKSkgOlxuXHRcdGFzdFxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWVtYmVyKGFzdE9iamVjdCwgZ290TmFtZSwgaXNMYXp5LCBpc01vZHVsZSkge1xuXHRyZXR1cm4gaXNMYXp5ID9cblx0XHRtc0xhenlHZXQoYXN0T2JqZWN0LCBuZXcgTGl0ZXJhbChnb3ROYW1lKSkgOlxuXHRcdGlzTW9kdWxlICYmIG9wdGlvbnMuaW5jbHVkZUNoZWNrcygpID9cblx0XHRtc0dldChhc3RPYmplY3QsIG5ldyBMaXRlcmFsKGdvdE5hbWUpKSA6XG5cdFx0bWVtYmVyKGFzdE9iamVjdCwgZ290TmFtZSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRvVGhyb3codGhyb3duKSB7XG5cdHJldHVybiBuZXcgVGhyb3dTdGF0ZW1lbnQodGhyb3duIGluc3RhbmNlb2YgUXVvdGUgP1xuXHRcdG5ldyBOZXdFeHByZXNzaW9uKEdsb2JhbEVycm9yLCBbdDAodGhyb3duKV0pIDpcblx0XHR0MCh0aHJvd24pKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbWVtYmVyU3RyaW5nT3JWYWwob2JqZWN0LCBtZW1iZXJOYW1lKSB7XG5cdHJldHVybiB0eXBlb2YgbWVtYmVyTmFtZSA9PT0gJ3N0cmluZycgP1xuXHRcdG1lbWJlcihvYmplY3QsIG1lbWJlck5hbWUpIDpcblx0XHRuZXcgTWVtYmVyRXhwcmVzc2lvbihvYmplY3QsIHQwKG1lbWJlck5hbWUpKVxufVxuIl0sInNvdXJjZVJvb3QiOiIvc3JjIn0=
